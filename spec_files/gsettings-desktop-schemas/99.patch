From f624a2d4ee9a99335c946dd0d8985b68dce6fad4 Mon Sep 17 00:00:00 2001
From: Dallas Strouse <dastrouses@gmail.com>
Date: Thu, 20 Feb 2025 21:09:50 -0600
Subject: [PATCH] schemas: Custom acceleration profile

Adds a custom acceleration profile, with step and speeds keys.

See the keys themselves for more information, or libinput documentation:
https://wayland.freedesktop.org/libinput/doc/latest/pointer-acceleration.html#the-custom-acceleration-profile
---
 headers/gdesktop-enums.h                      |  3 +-
 ...g.gnome.desktop.peripherals.gschema.xml.in | 60 +++++++++++++++++--
 2 files changed, 58 insertions(+), 5 deletions(-)

diff --git a/headers/gdesktop-enums.h b/headers/gdesktop-enums.h
index fa5cbfa..5b95a71 100644
--- a/headers/gdesktop-enums.h
+++ b/headers/gdesktop-enums.h
@@ -220,7 +220,8 @@ typedef enum
 {
   G_DESKTOP_POINTER_ACCEL_PROFILE_DEFAULT,
   G_DESKTOP_POINTER_ACCEL_PROFILE_FLAT,
-  G_DESKTOP_POINTER_ACCEL_PROFILE_ADAPTIVE
+  G_DESKTOP_POINTER_ACCEL_PROFILE_ADAPTIVE,
+  G_DESKTOP_POINTER_ACCEL_PROFILE_CUSTOM
 } GDesktopPointerAccelProfile;
 
 typedef enum
diff --git a/schemas/org.gnome.desktop.peripherals.gschema.xml.in b/schemas/org.gnome.desktop.peripherals.gschema.xml.in
index f9f892c..93a93ff 100644
--- a/schemas/org.gnome.desktop.peripherals.gschema.xml.in
+++ b/schemas/org.gnome.desktop.peripherals.gschema.xml.in
@@ -58,7 +58,20 @@
     <key name="accel-profile" enum="org.gnome.desktop.GDesktopPointerAccelProfile">
       <default>'default'</default>
       <summary>Acceleration profile</summary>
-      <description>Acceleration profile used for connected touchpads. The acceleration profile can be set to either default (“default”) which uses the default acceleration profile for each device, flat (“flat”), which accelerates by a device specific constant factor derived from the configured pointer speed, or adaptive (“adaptive”) which adapts the acceleration depending on the mouse movement. If a touchpad doesn’t support the configured profile, “default” will be used.</description>
+      <description>Acceleration profile used for connected touchpads. The acceleration profile can be set to either default (“default”) which uses the default acceleration profile for each device, flat (“flat”), which accelerates by a device specific constant factor derived from the configured pointer speed, adaptive (“adaptive”) which adapts the acceleration depending on the mouse movement, or custom ("custom") which will use a custom acceleration profile. If a touchpad doesn’t support the configured profile, “default” will be used.</description>
+    </key>
+    <key name="custom-accel-config" type="a{sv}">
+      <default>[{'pointer-step': &lt;1.0&gt;}, {'pointer-speeds': &lt;[0.0, 1.0]&gt;}]</default>
+      <summary>Custom acceleration configuration</summary>
+      <description>
+        A dictionary storing custom pointer acceleration settings.
+        Currently, valid entries are as follows:
+
+          - 'pointer-step': d
+          - 'pointer-speeds': ad
+
+        More entries may be added later.
+      </description>
     </key>
     <key name="speed" type="d">
       <default>0</default>
@@ -129,7 +142,20 @@
     <key name="accel-profile" enum="org.gnome.desktop.GDesktopPointerAccelProfile">
       <default>'default'</default>
       <summary>Acceleration profile</summary>
-      <description>Acceleration profile used for connected mice. The acceleration profile can be set to either default (“default”) which uses the default acceleration profile for each device, flat (“flat”), which accelerates by a device specific constant factor derived from the configured pointer speed, or adaptive (“adaptive”) which adapts the acceleration depending on the mouse movement. If a mouse doesn’t support the configured profile, “default” will be used.</description>
+      <description>Acceleration profile used for connected mice. The acceleration profile can be set to either default (“default”) which uses the default acceleration profile for each device, flat (“flat”), which accelerates by a device specific constant factor derived from the configured pointer speed, adaptive (“adaptive”) which adapts the acceleration depending on the mouse movement, or custom ("custom") which will use a custom acceleration profile. If a mouse doesn’t support the configured profile, “default” will be used.</description>
+    </key>
+    <key name="custom-accel-config" type="a{sv}">
+      <default>[{'pointer-step': &lt;1.0&gt;}, {'pointer-speeds': &lt;[0.0, 1.0]&gt;}]</default>
+      <summary>Custom acceleration configuration</summary>
+      <description>
+        A dictionary storing custom pointer acceleration settings.
+        Currently, valid entries are as follows:
+
+          - 'pointer-step': d
+          - 'pointer-speeds': ad
+
+        More entries may be added later.
+      </description>
     </key>
     <key name="middle-click-emulation" type="b">
       <default>false</default>
@@ -259,7 +285,20 @@
     <key name="accel-profile" enum="org.gnome.desktop.GDesktopPointerAccelProfile">
       <default>'default'</default>
       <summary>Acceleration profile</summary>
-      <description>Acceleration profile used for the trackball. The acceleration profile can be set to either default (“default”) which uses the default acceleration profile, flat (“flat”), which accelerates by a device specific constant factor derived from the configured speed, or adaptive (“adaptive”) which adapts the acceleration depending on the movement. If the trackball doesn’t support the configured profile, “default” will be used.</description>
+      <description>Acceleration profile used for the trackball. The acceleration profile can be set to either default (“default”) which uses the default acceleration profile, flat (“flat”), which accelerates by a device specific constant factor derived from the configured speed, adaptive (“adaptive”) which adapts the acceleration depending on the movement, or custom ("custom") which will use a custom acceleration profile. If the trackball doesn’t support the configured profile, “default” will be used.</description>
+    </key>
+    <key name="custom-accel-config" type="a{sv}">
+      <default>[{'pointer-step': &lt;1.0&gt;}, {'pointer-speeds': &lt;[0.0, 1.0]&gt;}]</default>
+      <summary>Custom acceleration configuration</summary>
+      <description>
+        A dictionary storing custom pointer acceleration settings.
+        Currently, valid entries are as follows:
+
+          - 'pointer-step': d
+          - 'pointer-speeds': ad
+
+        More entries may be added later.
+      </description>
     </key>
     <key name="middle-click-emulation" type="b">
       <default>false</default>
@@ -277,7 +316,20 @@
     <key name="accel-profile" enum="org.gnome.desktop.GDesktopPointerAccelProfile">
       <default>'default'</default>
       <summary>Acceleration profile</summary>
-      <description>Acceleration profile used for the pointing stick. The acceleration profile can be set to either default (“default”) which uses the default acceleration profile, flat (“flat”), which accelerates by a device specific constant factor derived from the configured speed, or adaptive (“adaptive”) which adapts the acceleration depending on the movement. If the pointing stick doesn’t support the configured profile, “default” will be used.</description>
+      <description>Acceleration profile used for the pointing stick. The acceleration profile can be set to either default (“default”) which uses the default acceleration profile, flat (“flat”), which accelerates by a device specific constant factor derived from the configured speed, adaptive (“adaptive”) which adapts the acceleration depending on the movement, or custom ("custom") which will use a custom acceleration profile. If the pointing stick doesn’t support the configured profile, “default” will be used.</description>
+    </key>
+    <key name="custom-accel-config" type="a{sv}">
+      <default>[{'pointer-step': &lt;1.0&gt;}, {'pointer-speeds': &lt;[0.0, 1.0]&gt;}]</default>
+      <summary>Custom acceleration configuration</summary>
+      <description>
+        A dictionary storing custom pointer acceleration settings.
+        Currently, valid entries are as follows:
+
+          - 'pointer-step': d
+          - 'pointer-speeds': ad
+
+        More entries may be added later.
+      </description>
     </key>
     <key name="scroll-method" enum="org.gnome.desktop.GDesktopPointingStickScrollMethod">
       <default>'default'</default>
-- 
GitLab

